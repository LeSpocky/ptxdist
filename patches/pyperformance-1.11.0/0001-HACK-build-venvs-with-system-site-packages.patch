From: Michael Olbrich <m.olbrich@pengutronix.de>
Date: Sun, 16 Feb 2025 12:02:24 +0100
Subject: [PATCH] HACK: build venvs with --system-site-packages

Some packages cannot be installed, so allow system site packages for the
venvs to provide those packages externally.

Signed-off-by: Michael Olbrich <m.olbrich@pengutronix.de>
---
 pyperformance/_venv.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/pyperformance/_venv.py b/pyperformance/_venv.py
index 34f6f82c13d5..adb37833c6e4 100644
--- a/pyperformance/_venv.py
+++ b/pyperformance/_venv.py
@@ -108,9 +108,9 @@ def create_venv(root, python=sys.executable, *,
     """Create a new venv at the given root, optionally installing pip."""
     already_existed = os.path.exists(root)
     if withpip:
-        args = ['-m', 'venv', root]
+        args = ['-m', 'venv', '--system-site-packages', root]
     else:
-        args = ['-m', 'venv', '--without-pip', root]
+        args = ['-m', 'venv', '--system-site-packages', '--without-pip', root]
     ec, _, _ = _utils.run_python(*args, python=python, env=env)
     if ec != 0:
         if cleanonfail and not already_existed:
