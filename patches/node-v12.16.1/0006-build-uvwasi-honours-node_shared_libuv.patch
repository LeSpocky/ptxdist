From: =?UTF-8?q?J=C3=A9r=C3=A9my=20Lal?= <kapouer@melix.org>
Date: Mon, 5 Jul 2021 00:22:46 +0200
Subject: [PATCH] build: uvwasi honours node_shared_libuv
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Fix #39248.

PR-URL: https://github.com/nodejs/node/pull/39260
Reviewed-By: Richard Lau <rlau@redhat.com>
Reviewed-By: Tobias Nie√üen <tniessen@tnie.de>
Reviewed-By: Colin Ihrig <cjihrig@gmail.com>
Reviewed-By: James M Snell <jasnell@gmail.com>
---
 deps/uvwasi/uvwasi.gyp | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/deps/uvwasi/uvwasi.gyp b/deps/uvwasi/uvwasi.gyp
index c07b07b608b7..3ff3daf3a11e 100644
--- a/deps/uvwasi/uvwasi.gyp
+++ b/deps/uvwasi/uvwasi.gyp
@@ -14,12 +14,16 @@
         'src/uv_mapping.c',
         'src/uvwasi.c',
       ],
-      'dependencies': [
-        '../uv/uv.gyp:libuv',
-      ],
       'direct_dependent_settings': {
         'include_dirs': ['include']
       },
+      'conditions': [
+        [ 'node_shared_libuv=="false"', {
+          'dependencies': [
+            '../uv/uv.gyp:libuv',
+          ],
+        }],
+      ],
     }
   ]
 }
